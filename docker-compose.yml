version: '3.8'

services:
  postgres-aluguel-db:
    image: postgres:13
    container_name: postgres-aluguel-db
    environment:
      - POSTGRES_USER=user
      - POSTGRES_PASSWORD=password
      - POSTGRES_DB=aluguel_db
    ports:
      - "5432:5432"
    volumes:
      - postgres-aluguel-data:/var/lib/postgresql/data

  postgres-seguro-db:
    image: postgres:13
    container_name: postgres-seguro-db
    environment:
      - POSTGRES_USER=user
      - POSTGRES_PASSWORD=password
      - POSTGRES_DB=seguro_db
    ports:
      - "5433:5432"
    volumes:
      - postgres-seguro-data:/var/lib/postgresql/data

  aluguel-service:
    build:
      context: ./aluguel-service
      dockerfile: Dockerfile
    container_name: aluguel-service
    ports:
      - "8081:8080"
    environment:
      SPRING_DATASOURCE_URL: jdbc:postgresql://postgres-aluguel-db:5432/aluguel_db
      SPRING_DATASOURCE_USERNAME: user
      SPRING_DATASOURCE_PASSWORD: password
    depends_on:
      - postgres-aluguel-db

  seguro-service:
    build:
      context: ./seguro-service
      dockerfile: Dockerfile
    container_name: seguro-service
    ports:
      - "8082:8080"
    environment:
      SPRING_DATASOURCE_URL: jdbc:postgresql://postgres-seguro-db:5432/seguro_db
      SPRING_DATASOURCE_USERNAME: user
      SPRING_DATASOURCE_PASSWORD: password
    depends_on:
      - postgres-seguro-db

volumes:
  postgres-aluguel-data:
  postgres-seguro-data:
